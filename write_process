<?php
require_once 'auth_guard.php';
require_once 'db.php';

if ($_SERVER['REQUEST_METHOD'] === 'POST') {

    $user_id = $_SESSION['user_id'];
    $title = $_POST['title'] ?: null;
    $content = $_POST['content'];
    $category = $_POST['category'];
    $rating = $_POST['rating'];
    $date = $_POST['date'];

    try {
        $stmt = $pdo->prepare("INSERT INTO posts (user_id, title, content, category, rating, date) VALUES (?, ?, ?, ?, ?, ?)");
        $stmt->execute([$user_id, $title, $content, $category, $rating, $date]);

        echo "<script>
                alert('ğŸ“Œ ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                window.location.href='posts.php';
            </script>";
    } catch(Exception $e) {
        echo "ì—ëŸ¬: " . $e->getMessage();
    }

} else {
    echo "ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.";
}
?>
